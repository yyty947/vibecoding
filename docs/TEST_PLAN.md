# Test Plan
## 项目：诺曼底登陆 (D-Day Defense)

---

## 测试概述

本文档定义了塔防游戏的自动化测试计划，使用 Playwright 进行浏览器自动化测试。

### 测试目标
- 验证游戏核心功能完整性
- 确保主流程端到端可运行
- 回归测试：确保修改不破坏现有功能

### 测试范围
- ✅ 页面加载与渲染
- ✅ 主菜单交互
- ✅ 游戏模式选择
- ✅ 防御塔放置
- ✅ 敌人生成与战斗
- ✅ 游戏结算

### 不在范围内
- 性能测试
- 压力测试
- 跨浏览器测试
- 移动端适配

---

## 环境准备

### 前置要求
```bash
# 检查 Python 版本
python --version  # 需要 3.7+

# 安装 Playwright（首次运行）
pip install playwright
playwright install chromium
```

### 启动项目
```bash
# 进入项目目录
cd C:\Users\y\Desktop\vibecoding\project

# 启动 HTTP 服务器（必需！不能直接打开 HTML）
python -m http.server 8000
```

服务器启动后，访问 **http://localhost:8000** 确认游戏可运行。

---

## 测试用例

### TC-01: 端到端完整流程（经典模式）

**优先级**: P0（必须通过）

**前置条件**: HTTP 服务器运行在端口 8000

**测试步骤**:
1. 打开游戏页面 `http://localhost:8000`
2. 验证主菜单显示（标题、两个模式按钮）
3. 点击"经典模式"按钮
4. 等待游戏加载（HUD 显示、倒计时开始）
5. 等待倒计时结束（8秒）
6. 点击"机枪塔"按钮
7. 在画布上点击放置防御塔
8. ��待敌人生成（10秒）
9. 验证敌人出现且被攻击
10. 等待游戏结束或手动点击"返回主菜单"

**预期结果**:
- 每个步骤无 JavaScript 错误
- 主菜单、游戏界面、防御塔、敌人正常显示
- 金币随击杀增加
- 生命值随敌人突破减少

**通过标准**:
- 所有步骤成功执行
- 控制台无 error 级别日志

---

### TC-02: 无尽模式基础验证

**优先级**: P1

**测试步骤**:
1. 打开游戏页面
2. 点击"无尽模式"按钮
3. 验证 HUD 显示"无尽模式"
4. 放置一个防御塔
5. 等待 5 秒
6. 验证敌人生成

**预期结果**:
- 无尽模式正常启动
- 敌人持续生成

---

### TC-03: 边界测试 - 金币不足

**优先级**: P2

**测试步骤**:
1. 启动游戏
2. 尝试放置超过金币允许的防御塔数量
3. 验证不能放置

**预期结果**:
- 超出金币后无法继续放置

---

### TC-04: 暂停/加速功能

**优先级**: P1

**测试步骤**:
1. 启动游戏
2. 点击速度按钮 `1x`
3. 验证切换到 `2x`
4. 验证切换到 `▶`（暂停）
5. 验证切换回 `1x`

**预期结果**:
- 三个状态正常切换
- 暂停时显示遮罩层

---

## 运行测试

### 方式一：运行完整测试套件

```bash
# 进入项目目录
cd C:\Users\y\Desktop\vibecoding\project

# 确保服务器运行
python -m http.server 8000

# 新开终端运行测试
cd .claude\skills\webapp-testing
python test_e2e.py
```

### 方式二：运行单个测试

修改 `test_e2e.py`，注释掉不需要的测试，保留需要的部分。

---

## 判断通过/失败

### 通过标准
- ✅ 所有断言（assert）通过
- ✅ 控制台无 error 级别日志
- ✅ 无 JavaScript 异常抛出
- ✅ 截图保存成功

### 失败标准
- ❌ 任何断言失败
- ❌ 出现 JavaScript 错误
- ❌ 页面元素找不到（超时）
- ❌ 游戏状态异常

### 输出文件
- `docs/test_results.json` - 测试结果 JSON
- `docs/screenshots/e2e/` - 测试截图
- 控制台输出 - 测试摘要

---

## 测试报告模板

```
测试执行时间: YYYY-MM-DD HH:MM:SS
测试人员: 自动化测试
测试环境: Windows + Chrome

测试结果:
┌─────────────┬────────┬──────────────┐
│ 测试用例    │ 状态   │ 备注         │
├─────────────┼────────┼──────────────┤
│ TC-01 E2E   │ PASS   │              │
│ TC-02 无尽  │ PASS   │              │
│ TC-03 边界  │ PASS   │              │
│ TC-04 暂停  │ FAIL   │ 按钮无响应   │
└─────────────┴────────┴──────────────┘

通过率: 75% (3/4)

发现问题:
1. 暂停按钮在战斗中无响应

建议:
- 检查事件绑定时机
- 验证 CSS z-index 层级
```

---

## 持续集成建议

### 自动化测试流程
```
1. 启动 HTTP 服务器（后台）
2. 运行 Playwright 测试
3. 收集测试结果和截图
4. 生成测试报告
5. 关闭服务器
```

### 与开发流程集成
- 每次提交代码前运行测试
- 修复 bug 后运行回归测试
- 发布前运行完整测试套件

---

## 附录

### 测试脚本位置
- `.claude/skills/webapp-testing/test_e2e.py` - 完整 E2E 测试脚本

### 相关文档
- `docs/spec.md` - 技术规范
- `docs/PRD.md` - 产品需求
- `docs/BUILD_LOG.md` - 构建日志

---

**版本**: v1.0
**更新日期**: 2025-01-26
**维护者**: 测试工程师
