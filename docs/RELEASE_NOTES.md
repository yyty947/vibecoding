# Release Notes

## v1.1.2 - 2026-01-30

### 🪟 多窗口检测与缓存感知

#### 问题
- 同时打开多个浏览器窗口时，不同窗口的游戏状态会互相干扰
- 浏览器缓存导致用户无法感知代码是否已更新

#### 解决方案

**多窗口检测（轻量级）**
- 使用 `BroadcastChannel` 检测同一浏览器中是否已打开其他游戏窗口
- 在菜单界面显示非侵入式警告提示："检测到多个游戏窗口，建议只开一个以避免数据异常"
- 如果不支持 BroadcastChannel，静默降级，不影响游戏

**版本号显示**
- 主菜单右下角显示当前版本号（v1.1.2）
- 帮助用户确认是否加载了最新代码

#### 技术说明
- **为什么不用 sessionStorage 隔离状态？**  
  项目约束要求"避免过度工程化"。多窗口支持需要重构 Tower.js 的模块级状态，改动范围过大。提示方案符合"简单 > 复杂"的宪法。
- **BroadcastChannel 兼容性**：Chrome 54+, Firefox 38+, Safari 15.4+（现代浏览器均支持）

---

## v1.1.0 - 2026-01-30

### 🎯 平衡性微调 - "让边缘化内容回归"

基于实测反馈的小幅调整，目标是让被边缘化的塔重新有存在感，同时保持经济压力健康。

#### 🔧 加农炮 - 重甲克星定位强化

**问题**：前期到后期都很少成为理性选择，DPS优势小、溅射价值被稀释、节奏错位

**调整**：
- 破甲率：50% → **80%**（专业破甲）
- 新增：对护甲>0.5的敌人伤害 **×1.5**
- 溅射范围：30 → **40**
- 基础伤害：40 → 35（平衡高甲加成）
- 射速：800ms → **750ms**
- 射程：80 → **85**

**预期效果**：看到护盾兵/坦克时，玩家会主动想"这里需要加农炮"

#### ⚡ 电磁塔 - 节奏控制核心重构

**问题**：控制效果不可预期，纯辅助定位但价值不明显，解锁时已有成熟防线

**调整**：
- 机制重构：20%概率眩晕 → **每第4发必定眩晕1.5秒**（可预期）
- 射程：100 → **120**（更好覆盖）
- 射速：800ms → **600ms**（更快节奏）
- 新增：对眩晕目标伤害 **+50%**（团队贡献）
- 新增：**视觉计数器**（塔身显示1-4的充能进度）

**预期效果**：电磁塔成为"控住集火点"的战术核心，玩家会围绕它布置其他塔

#### 💰 波次结算 - 前/中期容错提升

**问题**：每波清除50%塔，玩家需要疯狂点点点重新布防

**调整**：清除比例随波次递增（更平滑）
- 1-3波：**35%**（新手保护，少点几次）
- 4-6波：**38%**（逐步收紧，原40%）
- 7-9波：**45%**（保持压力，原50%）
- 10波+：**50%**（大后期压力，不变）

**注意**：返还比例不变（40%/25%/10%），仅调整清除数量

#### 📊 整体评估

- ✅ 经济压力保持：后期返还仍为10%，资金膨胀风险可控
- ✅ 避免唯一最优解：加农炮仅对高甲有效，杂兵仍需机枪/激光
- ✅ 电磁塔不强制：机制可预期但不强求必出

#### 💰 杀敌奖励 - 后期希望保留（v1.1.1微调）

**问题**：10波后杀敌奖励仅20%，玩家失去所有金币来源，陷入"彻底绝望"

**调整**：大后期（10波+）杀敌奖励 **20% → 22%**
- 数值差异小，但心理感受是"还能打" vs "彻底绝望"

---

## v1.0.0 - 2026-01-27

### 🎉 首个正式发布

"诺曼底登陆"塔防游戏首个正式版本发布！

### ✨ 核心功能

- **两种游戏模式**
  - 经典模式：10波固定敌人，每波约40个
  - 无尽模式：无限波次，难度递增

- **六种防御塔**（渐进解锁）
  - 机枪塔：高射速，低成本（50金币）- 初始解锁
  - 加农炮：高伤害，中射程（100金币）- 初始解锁
  - 狙击塔：超远射程，高伤害（75金币）- 第3波解锁
  - 激光塔：持续伤害（125金币）- 第5波解锁
  - 电磁塔：减速控制（150金币）- 第7波解锁
  - 火箭塔：范围爆发（200金币）- 第10波解锁

- **全局升级系统**
  - 塔类型全局升级，最高3级
  - 同步提升所有同类型塔

- **四种敌人**
  - 士兵：快速移动，30HP
  - 登陆艇：慢速但耐打，100HP
  - 坦克：高血量，200HP
  - 自杀兵：快速自爆，20HP

### 🎮 游戏特性

- **8秒发育时间**：第一波敌人出现前有充足时间布置防御
- **倒计时提示**：清晰显示敌军来袭时间
- **波次完成通知**：每波结束后显示"✓ 第X波完成！"
- **独立控制**：暂停按钮⏸ + 速度切换（1x/2x）
- **Combo连击系统**：2秒内连续击杀获得额外金币奖励倍率
- **交战系统**：敌人可攻击并摧毁防御塔
- **全屏支持**：建筑可在全屏任意位置放置
- **波次进度显示**：经典模式显示"第X/10波"
- **融合UI**：升级面板与塔面板无缝连接

### 🔧 技术特性

- **动态Canvas尺寸**：自动适配浏览器窗口大小
- **ES6模块化**：清晰的代码结构
- **零依赖**：只需Python标准库的http.server
- **一键启动**：提供Windows和Linux/Mac启动脚本

### 📋 系统要求

- Python 3.x
- 现代浏览器（Chrome、Firefox、Edge）
- 屏幕分辨率：建议 1280x720 或更高

### 🚀 快速开始

**Windows**: 双击 `start.bat`
**Linux/Mac**: 运行 `bash start.sh`

然后在浏览器打开 http://localhost:8001

### 📊 测试状态

- ✅ 第一轮测试（2025-01-26）：2/3 通过
- ✅ 第二轮测试（2025-01-26）：3/3 通过（100%）
- ✅ 第三轮测试（2026-01-27）：5/5 通过（100%）
- ✅ 第四轮测试（2026-01-28）：5/5 通过（三阶段功能验证）
- ✅ 第五轮测试（2026-01-28）：7/7 通过（重构验证）

详细测试报告请查看 [TEST_REPORT.md](./TEST_REPORT.md)

### 📝 已知问题

无

### 🔄 升级说明

首次发布，无需升级。

### 📜 许可证

GPL 3.0
