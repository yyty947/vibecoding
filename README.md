⚠️ 对 Claude：
本项目存在 CLAUDE.md，请在任何修改代码前先阅读并遵守。

# 诺曼底登陆 (D-Day Defense)

> 一个基于 HTML5 Canvas 的塔防游戏

![License](https://img.shields.io/badge/license-GPL%203.0-blue)
![Status](https://img.shields.io/badge/status-production--ready-green)

## 项目简介

"诺曼底登陆"是一款二战题材的塔防游戏。玩家需要通过在战场上放置不同类型的防御塔，抵御不断来袭的敌军士兵和登陆艇。

## 功能特性

- **两种游戏模式**: 经典模式（10波）和无尽模式（无限挑战）
- **六种防御塔**: 机枪塔、加农炮、狙击塔、激光塔、电磁塔、火箭塔（渐进解锁）
- **全局升级系统**: 塔类型全局升级，最高5级，同步提升所有同类型塔
- **四种敌人**: 士兵、登陆艇、坦克、自杀兵（不同波次出现）
- **Combo连击系统**: 2秒内连续击杀获得额外金币奖励倍率
- **交战系统**: 敌人可攻击并摧毁防御塔
- **波次结算机制**: 每波结束后随机清除50%的防御塔，返还50%投入成本
- **完整游戏流程**: 主菜单 → 模式选择 → 游戏 → 结算
- **独立控制**: 暂停按钮⏸ + 速度切换（1x/2x）

## 快速开始

### 方法一：一键启动（推荐）

双击运行启动脚本即可：

**Windows 用户**:
```
双击 start.bat
```

**Linux/Mac 用户**:
```bash
./start.sh
# 或
bash start.sh
```

启动后会自动：
1. ✅ 检查 Python 环境
2. ✅ 切换到项目目录
3. ✅ 启动 HTTP 服务器
4. ✅ 显示访问地址

在浏览器打开显示的地址即可开始游戏！

### 方法二   手动启动

**环境要求**:
- Python 3.x
- 现代浏览器（Chrome、Firefox、Edge）

**启动步骤**:
```bash
# 在项目目录启动 HTTP 服务器
python -m http.server 8001
```

然后在浏览器访问: **http://localhost:8001**

> **注意**: 由于使用了 ES6 模块，必须通过 HTTP 服务器运行，不能直接双击 HTML 文件。

### 停止服务器

在终端按 `Ctrl + C` 停止服务器。

## 游戏操作

1. **选择模式**: 点击"经典模式"或"无尽模式"开始游戏
2. **放置防御塔**:
   - 点击底部面板的防御塔图标选择类型
   - 点击战场上的位置放置
3. **升级塔类型**: 在升级面板中点击塔类型按钮，全局升级所有该类型塔
4. **控制游戏**: 点击暂停按钮⏸暂停，点击速度按钮切换1x/2x
5. **游戏目标**: 防止敌人突破防线，尽可能存活更多波次

## 波次机制说明

### 波次流程
```
准备期(10秒) → 第1波开始 → 敌人刷新 → 波次完成 → 2秒结算 + 3秒准备 → 第2波 → ...
```

**说明**:
- 首波准备时间：10秒
- 后续波次：波次完成后等待2秒，然后3秒准备时间
- 每波结算：随机清除约50%已建防御塔，返还50%累计投入成本

### 难度曲线
| 波次 | 敌人数量 | 初始刷新间隔 | 最小间隔 |
|------|----------|--------------|----------|
| 第1波 | 40个 | 1200ms | 300ms |
| 第5波 | 60个 | 960ms | 300ms |
| 第10波 | 85个 | 660ms | 300ms |

- **敌人数量**: 每波增加 5 个
- **刷新速度**: 波次开始时较慢，随时间逐渐加快至最小间隔
- **敌人类型**: 第3波登陆艇、第5波坦克、第7波自杀兵
- **防御塔解锁**: 第2波狙击塔、第5波激光塔、第7波电磁塔、第10波火箭塔

### 游戏结束条件
- **失败**: 生命值降为 0
- **胜利（经典模式）**: 完成第 10 波

## 升级系统

### 升级规则
- **全局升级**: 升级某个塔类型时，场上所有该类型的塔同步升级
- **最高等级**: 5级
- **升级方式**: 点击底部升级面板中的塔类型按钮

### 升级费用

| 塔类型 | 1→2级 | 2→3级 | 3→4级 | 4→5级 | 总计 |
|--------|-------|-------|-------|-------|------|
| 机枪塔 | 80 | 160 | 280 | 450 | 970 |
| 加农炮 | 150 | 300 | 500 | 800 | 1750 |
| 狙击塔 | 120 | 240 | 400 | 650 | 1410 |
| 激光塔 | 200 | 400 | 700 | 1100 | 2400 |
| 电磁塔 | 250 | 500 | 850 | 1300 | 2900 |
| 火箭塔 | 300 | 600 | 1000 | 1500 | 3400 |

### 升级倍率

| 等级 | 伤害倍率 | 范围倍率 | 射速倍率 |
|------|----------|----------|----------|
| Lv.1 | 1.0x | 1.0x | 1.0x |
| Lv.2 | 1.4x | 1.15x | 1.08x |
| Lv.3 | 1.9x | 1.3x | 1.15x |
| Lv.4 | 2.5x | 1.45x | 1.22x |
| Lv.5 | 3.2x | 1.6x | 1.3x |

### 等级外观区分
- 塔的基座大小随等级增大
- 塔主体大小随等级增大
- 边框颜色随等级变化（灰→银灰→蓝→紫→白）
- 满级(5级)特殊效果：渐变金橙红边框 + 金色等级数字

## 项目结构

```
project/
├── index.html              # 主页面
├── start.bat               # Windows 启动脚本
├── start.sh                # Linux/Mac 启动脚本
├── src/
│   ├── main.js             # 入口文件
│   ├── styles.css          # 样式文件
│   ├── core/
│   │   ├── Game.js         # 游戏主控制器
│   │   ├── Renderer.js     # 渲染器
│   │   └── Input.js        # 输入处理
│   ├── entities/
│   │   ├── Enemy.js        # 敌人类
│   │   ├── Tower.js        # 防御塔类
│   │   └── Projectile.js   # 子弹类
│   ├── systems/
│   │   ├── WaveSystem.js       # 波次系统
│   │   ├── CollisionSystem.js  # 碰撞检测
│   │   └── UpgradeSystem.js    # 升级系统
│   └── utils/
│       └── config.js       # 配置文件
└── docs/
    ├── PRD.md              # 产品需求文档
    ├── spec.md             # 技术规范
    ├── BUILD_LOG.md        # 构建日志
    ├── TEST_PLAN.md        # 测试计划
    ├── TEST_REPORT.md      # 测试报告
    ├── RELEASE_NOTES.md    # 发布说明
    └── SKILLS_USED.md      # Skills 使用记录
```

## 文档

| 文档 | 描述 |
|------|------|
| [PRD](./docs/PRD.md) | 产品需求文档 |
| [技术规范](./docs/spec.md) | 技术设计文档 |
| [构建日志](./docs/BUILD_LOG.md) | 开发过程记录 |
| [测试计划](./docs/TEST_PLAN.md) | 自动化测试计划 |
| [测试报告](./docs/TEST_REPORT.md) | 测试执行报告 |
| [发布说明](./docs/RELEASE_NOTES.md) | 版本发布记录 |
| [Skills 使用记录](./docs/SKILLS_USED.md) | webapp-testing 技能应用 |

## 开发历程

- **2025-01-25**: 项目初始化，完成 MVP 开发
- **2025-01-26**: 添加倒计时、暂停/加速功能
- **2026-01-27**: 修复波次跳变、画布清理、Canvas 尺寸等 Bug
- **2026-01-27**: 完成三轮自动化测试，100% 通过率

## 测试状态

| 测试轮次 | 日期 | 通过率 | 主要内容 |
|---------|------|--------|----------|
| 第一轮 | 2025-01-26 | 67% | 事件绑定、数据结构问题 |
| 第二轮 | 2025-01-26 | 100% | 缺少倒计时提示 |
| 第三轮 | 2026-01-27 | 100% | 波次跳变、画布清理问题 |
| 第四轮 | 2026-01-28 | 100% | 三阶段功能验证（交战/结算/解锁） |
| 第五轮 | 2026-01-28 | 100% | 重构验证（全局升级/UI融合） |

详细测试报告请查看 [TEST_REPORT.md](./docs/TEST_REPORT.md)

## License

GPL 3.0
